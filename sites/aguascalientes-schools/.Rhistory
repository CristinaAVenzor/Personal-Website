name=c(as.character(matrix_profile$source),
as.character(matrix_profile$target)) %>%
unique())
# With networkD3, connection must be provided using id, not using real name like in the links dataframe.. So we need to reformat it.
matrix_profile$IDsource <- match(matrix_profile$source, nodes$name)-1
matrix_profile$IDtarget <- match(matrix_profile$target, nodes$name)-1
# Make the Network
p <- sankeyNetwork(Links = matrix_profile,
Nodes = nodes,
Source = "IDsource",
Target = "IDtarget",
Value = "value",
NodeID = "name",
sinksRight=FALSE,
fontSize = 12)
p
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01")
mapa$NOMGEO
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "" ~ "",
NOMGEO == "" ~ "",
NOMGEO == "" ~ "",
NOMGEO == "" ~ "",
NOMGEO == "" ~ "",))
unique(schools$MUNICIPIO)
data2plot <- as.data.frame(schools) %>%
mutate(NIVEL = str_trim(NIVEL),
MUNICIPIO = str_trim(MUNICIPIO)) %>%
group_by(MUNICIPIO) %>%
summarise(value = n(), .groups = 'drop')
data2plot
data2plot <- as.data.frame(schools) %>%
mutate(NIVEL = str_trim(NIVEL),
MUNICIPIO = str_trim(MUNICIPIO)) %>%
group_by(MUNICIPIO) %>%
summarise(value = n(), .groups = 'drop') %>%
mutate(
value2plot = value / sum(value) * 100,
value2plot = paste0(round(value2plot, 0), "%"))
data2plot
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA ",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO"))
data2plot
quintiles <- quantile(round(data2plot$value, 0), probs = seq(0, 1, by = 0.2))
quintiles
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA ",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO"))
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value2plot >= 2   & value2plot <= 26.4   ~ "5.1%-9.8%",
value2plot > 26.4   & value2plot <= 90 ~ "9.8%-12.6%",
value2plot > 90 & value2plot <= 103.8 ~ "12.6%-18.2%",
value2plot > 103.8 & value2plot <= 186.8   ~ "18.2%-23.3%",
value2plot > 186.8   & value2plot <= 1342   ~ "23.3%-36.8%"
),
color_group = as.factor(color_group)
)
ags_map <- mapa %>%
left_join(data2plot, by = "value") %>%
mutate(
color_group = case_when(
value2plot >= 2   & value2plot <= 26.4   ~ "5.1%-9.8%",
value2plot > 26.4   & value2plot <= 90 ~ "9.8%-12.6%",
value2plot > 90 & value2plot <= 103.8 ~ "12.6%-18.2%",
value2plot > 103.8 & value2plot <= 186.8   ~ "18.2%-23.3%",
value2plot > 186.8   & value2plot <= 1342   ~ "23.3%-36.8%"
),
color_group = as.factor(color_group)
)
ags_map <- mapa %>%
left_join(data2plot, by = "value")
data2plot <- as.data.frame(schools) %>%
mutate(NIVEL = str_trim(NIVEL),
MUNICIPIO = str_trim(MUNICIPIO)) %>%
group_by(MUNICIPIO) %>%
summarise(value = n(), .groups = 'drop') %>%
mutate(
value2plot = value / sum(value) * 100,
value2plot = paste0(round(value2plot, 0), "%"))
data2plot
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO")
ags_map <- mapa %>%
left_join(data2plot, by = "NOMGEO") %>%
mutate(
color_group = case_when(
value2plot >= 2   & value2plot <= 26.4   ~ "5.1%-9.8%",
value2plot > 26.4   & value2plot <= 90 ~ "9.8%-12.6%",
value2plot > 90 & value2plot <= 103.8 ~ "12.6%-18.2%",
value2plot > 103.8 & value2plot <= 186.8   ~ "18.2%-23.3%",
value2plot > 186.8   & value2plot <= 1342   ~ "23.3%-36.8%"
),
color_group = as.factor(color_group)
)
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA ",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO")) %>%
rename(MUNICIPIO = NOMGEO)
mapa$MUNICIPIO
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape"))
mapa$NOMGEO
unique(mapa$NOMGEO)
unique(mapa$NOMGEO)
table(mapa$NOMGEO)
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01")
unique(mapa$NOMGEO)
table(mapa$NOMGEO, useNA = "always")
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO")
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA ",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO")) %>%
rename(MUNICIPIO = NOMGEO)
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value2plot >= 2   & value2plot <= 26.4   ~ "5.1%-9.8%",
value2plot > 26.4   & value2plot <= 90 ~ "9.8%-12.6%",
value2plot > 90 & value2plot <= 103.8 ~ "12.6%-18.2%",
value2plot > 103.8 & value2plot <= 186.8   ~ "18.2%-23.3%",
value2plot > 186.8   & value2plot <= 1342   ~ "23.3%-36.8%"
),
color_group = as.factor(color_group)
)
cat_palette <- c( "5.1%-9.8%"  = "#99D7DD",
"9.8%-12.6%"  = "#33AEBA",
"12.6%-18.2%"  = "#0087A3",
"18.2%-23.3%"  = "#00617F",
"23.3%-36.8%" = "#004E70")
# Drawing plot
p <- ggplot(ags_map, aes(label = ESTADO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
)
p
# Drawing plot
p <- ggplot(ags_map, aes(label = MUNICIPIO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
); p
ags_map$color_group
data2plot
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value >= 2     & value <= 26.4   ~ "5.1%-9.8%",
value > 26.4   & value <= 90 ~ "9.8%-12.6%",
value > 90     & value <= 103.8 ~ "12.6%-18.2%",
value > 103.8  & value <= 186.8   ~ "18.2%-23.3%",
value > 186.8  & value <= 1342   ~ "23.3%-36.8%"
),
color_group = as.factor(color_group)
)
cat_palette <- c( "5.1%-9.8%"  = "#99D7DD",
"9.8%-12.6%"  = "#33AEBA",
"12.6%-18.2%"  = "#0087A3",
"18.2%-23.3%"  = "#00617F",
"23.3%-36.8%" = "#004E70")
# Drawing plot
p <- ggplot(ags_map, aes(label = MUNICIPIO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
); p
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value  <= 10   ~ "bajo",
value  <= 250  ~ "medio",
value  <= 1342   ~ "alto"
),
color_group = as.factor(color_group)
)
cat_palette <- c( "bajo"  = "#99D7DD",
"medio"  = "#0087A3",
"alto" = "#004E70")
# Drawing plot
p <- ggplot(ags_map, aes(label = MUNICIPIO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
); p
ags_map$MUNICIPIO
ags_map
data2plot <- as.data.frame(schools) %>%
mutate(NIVEL = str_trim(NIVEL),
MUNICIPIO = str_trim(MUNICIPIO)) %>%
group_by(MUNICIPIO) %>%
summarise(value = n(), .groups = 'drop') %>%
mutate(
value2plot = value / sum(value) * 100,
value2plot = paste0(round(value2plot, 0), "%"))
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO")) %>%
rename(MUNICIPIO = NOMGEO)
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value  <= 10   ~ "bajo",
value  <= 250  ~ "medio",
value  <= 1342   ~ "alto"
),
color_group = as.factor(color_group)
)
cat_palette <- c( "bajo"  = "#99D7DD",
"medio"  = "#0087A3",
"alto" = "#004E70")
# Drawing plot
p <- ggplot(ags_map, aes(label = MUNICIPIO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
); p
ags_map
data2plot <- as.data.frame(schools) %>%
mutate(NIVEL = str_trim(NIVEL),
MUNICIPIO = str_trim(MUNICIPIO)) %>%
group_by(MUNICIPIO) %>%
summarise(value = n(), .groups = 'drop') %>%
mutate(
value2plot = value / sum(value) * 100,
value2plot = paste0(round(value2plot, 0), "%"))
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO")) %>%
rename(MUNICIPIO = NOMGEO)
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value  <= 60   ~ "bajo",
value  <= 250  ~ "medio",
value  <= 1342   ~ "alto"
),
color_group = as.factor(color_group)
)
cat_palette <- c( "bajo"  = "#99D7DD",
"medio"  = "#0087A3",
"alto" = "#004E70")
# Drawing plot
p <- ggplot(ags_map, aes(label = MUNICIPIO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
); p
ags_map
mapa
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape"))
mapa
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "001")
mapa
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape"))
mapa
View(mapa)
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01")
View(mapa)
data2plot
data2plot <- as.data.frame(schools) %>%
mutate(NIVEL = str_trim(NIVEL),
MUNICIPIO = str_trim(MUNICIPIO)) %>%
group_by(MUNICIPIO) %>%
summarise(value = n(), .groups = 'drop') %>%
mutate(
value2plot = value / sum(value) * 100,
value2plot = paste0(round(value2plot, 0), "%"))
mapa <- st_read(paste0(path2SP,"Data/5_1_4_3_Municipios_shape")) %>%
filter(CVE_ENT == "01") %>%
mutate(NOMGEO = case_when(NOMGEO == "Aguascalientes"         ~ "AGUASCALIENTES",
NOMGEO == "Asientos"               ~ "ASIENTOS",
NOMGEO == "Calvillo"               ~ "CALVILLO",
NOMGEO == "Cos\xedo"               ~ "COSÍO",
NOMGEO == "Jes\xfas Mar\xeda"      ~ "JESÚS MARÍA",
NOMGEO == "Pabell\xf3n de Arteaga" ~ "ENCARNACIÓN DE DÍAZ",
NOMGEO == "Rinc\xf3n de Romos"     ~ "RINCÓN DE ROMOS",
NOMGEO == "San Jos\xe9 de Gracia"  ~ "SAN JOSÉ DE GRACIA",
NOMGEO == "Tepezal\xe1"            ~ "TEPEZALÁ",
NOMGEO == "El Llano"               ~ "EL LLANO",
NOMGEO == "San Francisco de los Romo" ~ "SAN FRANCISCO DE LOS ROMO")) %>%
rename(MUNICIPIO = NOMGEO)
ags_map <- mapa %>%
left_join(data2plot, by = "MUNICIPIO") %>%
mutate(
color_group = case_when(
value  <= 60   ~ "bajo",
value  <= 250  ~ "medio",
value  <= 1342   ~ "alto"
),
color_group = as.factor(color_group)
)
cat_palette <- c( "bajo"  = "#99D7DD",
"medio"  = "#0087A3",
"alto" = "#004E70")
# Drawing plot
p <- ggplot(ags_map, aes(label = MUNICIPIO)) +
geom_sf(data  = ags_map,
aes(fill = color_group),
color = "grey65",
size  = 0.5) +
geom_sf(data  = ags_map,
fill  = NA,
color = "grey25") +
scale_fill_manual("",
values   = cat_palette,
na.value = "grey95",
drop = F) +
# scale_y_continuous(limits = c(1445631, 5273487)) +
# scale_x_continuous(limits = c(2581570, 5967160)) +
theme_minimal() +
theme(
plot.background = element_blank(),
axis.text       = element_blank(),
legend.position = "none",
panel.grid      = element_blank(),
panel.border    = element_blank(),
plot.margin     = margin(0,0,0,0)
); p
data2plot
matrix_profile
ft
View(ft)
# Convert to a flextable
ft <- flextable(data2plot)
# Apply conditional background color for rows where TIPO is "PÚBLICO"
ft <- ft %>%
theme_vanilla() %>%
set_header_labels(
MUNICIPIO = "Nivel Educativo",
value = "Total de Escuelas",
value2plot = "Proporción (%)"
) %>%
fontsize(size = 10) %>%
bold(part = "header")
# Display the flextable
ft
